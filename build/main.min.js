
var app=angular.module("app",["ui.router"]);app.run(["$rootScope",function(a){a.version="0.1",a.author="vczero",a.author_alias="鬼谣",a.isNoLoaded=!0,a.bookList=[],a.musicList=[],a.movieList=[],a.keywordsObj={book:"",music:"",movie:""}}]),app.constant("ServiceConfig",{book_search:"https://api.douban.com/v2/book/search",book_search_id:"https://api.douban.com/v2/book/",music_search:"https://api.douban.com/v2/music/search",music_search_id:"https://api.douban.com/v2/music/",movie_search:"https://api.douban.com/v2/movie/search",movie_search_id:"https://api.douban.com/v2/movie/subject/"}),app.config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/"),a.state("index",{url:"/",views:{header:{templateUrl:"../html/views/list_header.html",controller:"SearchController"},container:{templateUrl:"../html/views/list_book.html",controller:"BookListController"},footer:{templateUrl:"../html/views/list_footer.html",controller:""}}}).state("book_list",{url:"/book",views:{header:{templateUrl:"../html/views/list_header.html",controller:"SearchController"},container:{templateUrl:"../html/views/list_book.html",controller:"BookListController"},footer:{templateUrl:"../html/views/list_footer.html",controller:""}}}).state("book_detail",{url:"/book/:id",views:{header:{templateUrl:"../html/views/list_header.html",controller:"SearchController"},container:{templateUrl:"../html/views/detail_book.html",controller:"BookDetailController"},footer:{templateUrl:"../html/views/list_footer.html",controller:""}}}).state("music_lsit",{url:"/music",views:{header:{templateUrl:"../html/views/list_header.html",controller:"SearchController"},container:{templateUrl:"../html/views/list_music.html",controller:"musicListController"},footer:{templateUrl:"../html/views/list_footer.html",controller:""}}}).state("movie_lsit",{url:"/movie",views:{header:{templateUrl:"../html/views/list_header.html",controller:"SearchController"},container:{templateUrl:"../html/views/list_movie.html",controller:"movieListController"},footer:{templateUrl:"../html/views/list_footer.html",controller:""}}}).state("search",{url:"/search/:type",views:{header:{templateUrl:"../html/views/search.html",controller:"Search"},container:{templateUrl:"",controller:""},footer:{templateUrl:"",controller:""}}})}]),app.directive("loading",function(){var a='<div id="loading" ng-show="isNoLoaded"><img src="../imgs/loading.gif" /></div>';return{restrict:"AE",template:a,replace:!0}}),app.directive("tip",function(){var a='<div id="loading" ng-show="isNoLoaded"><img src="../imgs/loading.gif" /></div>';return{restrict:"AE",template:a,replace:!0}}),app.factory("bookList",["$rootScope","$http","ServiceConfig",function(a,b,c){a.isNoLoaded=!0;var d={getData:function(d){a.isNoLoaded=!0,b.jsonp(c.book_search+"?callback=searchBookList&count=10&q="+d),window.searchBookList=function(b){b.books.length&&(a.isNoLoaded=!1);for(var c=[],d=0;d<b.books.length;d++){var e=b.books[d],f={id:e.id,image:e.image,origin_title:e.title||"书名未共享",author:e.author[0]||"作者未知",publisher:e.publisher||"出版社未知",price:e.price.split(".")[0]||"未知",pages:e.pages};c.push(f)}a.bookList=c}}};return d}]),app.factory("movieList",["$rootScope","$http","ServiceConfig",function(a,b,c){a.isNoLoaded=!0;var d={getData:function(d){a.isNoLoaded=!0,b.jsonp(c.movie_search+"?callback=movieSearch&count=5&q="+d),window.movieSearch=function(b){a.isNoLoaded=!1,b.subjects&&b.subjects.length&&(a.movieList=b.subjects)}}};return d}]),app.factory("musicList",["$rootScope","$http","ServiceConfig",function(a,b,c){a.isNoLoaded=!0;var d={getData:function(d){a.isNoLoaded=!0,b.jsonp(c.music_search+"?callback=musicSearch&count=10&q="+d),window.musicSearch=function(b){a.isNoLoaded=!1,b.musics&&b.musics.length&&(a.musicList=b.musics)}}};return d}]),app.controller("BookListController",["$rootScope","bookList",function(a,b){a.keywordsObj.book||(a.keywordsObj.book="C语言"),b.getData(a.keywordsObj.book)}]),app.controller("BookDetailController",["$rootScope","$http","$scope","$location","ServiceConfig",function(a,b,c,d,e){var f=d.path().split("/book/")[1]||"";a.isNoLoaded=!0,b.jsonp(e.book_search_id+""+f+"?callback=showBookDeatil"),window.showBookDeatil=function(b){a.isNoLoaded=!1,c.data=b}}]),app.controller("MenuController",["$scope","$location",function(a,b){a.bookSearch=function(){b.path("/book")},a.musicSearch=function(){b.path("/music")},a.movieSearch=function(){b.path("/movie")}}]),app.controller("movieListController",["$rootScope","movieList",function(a,b){a.keywordsObj.movie||(a.keywordsObj.movie="幸福"),b.getData(a.keywordsObj.movie)}]),app.controller("musicListController",["$rootScope","musicList",function(a,b){a.keywordsObj.music||(a.keywordsObj.music="刘德华"),b.getData(a.keywordsObj.music)}]);var Search=function(a,b,c,d,e,f){var g=c.path();b.isNoLoaded=!1,a.search=function(){var d=a.keywords;-1!==g.indexOf("/book")?(d&&(b.keywordsObj.book=d),c.path("/book")):-1!==g.indexOf("/music")?(d&&(b.keywordsObj.music=d),c.path("/music")):-1!==g.indexOf("/movie")&&(d&&(b.keywordsObj.movie=d),c.path("/movie"))}};Search.$inject=["$scope","$rootScope","$location","bookList","musicList","movieList"],app.controller("Search",Search);var SearchController=function(a,b,c){var d=c.path();a.goToSearch=function(){-1!==d.indexOf("/book")||"/"===d?c.path("/search/book"):-1!==d.indexOf("/music")||"/music"===d?c.path("/search/music"):(-1!==d.indexOf("/movie")||"/movie"===d)&&c.path("/search/movie")}};SearchController.$inject=["$scope","$rootScope","$location"],app.controller("SearchController",SearchController);